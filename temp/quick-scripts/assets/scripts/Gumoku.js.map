{"version":3,"sources":["Gumoku.js"],"names":["cc","Class","extends","Component","properties","chessPrefab","default","type","Prefab","chessList","node","gameState","whiteChessFrame","SpriteFrame","blackChessFrame","lastChess","Node","visible","initiateChessBoard","$this","x","y","newChess","instantiate","addChild","setPosition","v2","getComponent","tag","on","EventType","TOUCH_END","event","thisNode","target","Sprite","spriteFrame","judgeOver","push","console","log","lastSpriteFrame","horizental","isLinked","i","frame","vertical","leftSlash","f","rightSlash","onLoad","start"],"mappings":"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","file":"Gumoku.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        chessPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        chessList:{\r\n            default:[],\r\n            type:[cc.node]\r\n        },\r\n        gameState : \"white\",\r\n        whiteChessFrame:{\r\n            default:null,\r\n            type:cc.SpriteFrame\r\n        },\r\n        blackChessFrame:{\r\n            default:null,\r\n            type:cc.SpriteFrame\r\n        },\r\n        lastChess:{\r\n            default:null,\r\n            type:cc.Node,\r\n            visible:false\r\n        }\r\n    },\r\n    initiateChessBoard(){\r\n        var $this = this;\r\n        for(var x = 0 ;x < 15; x++){\r\n            for(var y = 0;y < 15; y++){\r\n                var newChess = cc.instantiate(this.chessPrefab);\r\n                this.node.addChild(newChess);\r\n                newChess.setPosition(cc.v2(x*40+20,y*40+20));\r\n                newChess.getComponent('chess').tag = y*15+x;//tag除以15，商为Y坐标，余数为x坐标\r\n                newChess.on(cc.Node.EventType.TOUCH_END,function(event){\r\n                    var thisNode = event.target.getComponent(cc.Sprite);\r\n                    if($this.gameState ==='white' && thisNode.spriteFrame == null){\r\n                        thisNode.spriteFrame = $this.whiteChessFrame;\r\n                        $this.gameState = 'black';\r\n                        $this.lastChess = thisNode;\r\n                        $this.judgeOver();\r\n                    }else if($this.gameState=='black' && thisNode.spriteFrame == null){\r\n                        thisNode.spriteFrame = $this.blackChessFrame;\r\n                        $this.gameState = 'white';\r\n                        $this.lastChess = thisNode;\r\n                        $this.judgeOver();\r\n                    }                    \r\n                });\r\n                this.chessList.push(newChess);\r\n            }\r\n        }\r\n    },\r\n    //判定胜负\r\n    judgeOver(){\r\n        console.log(\"开始判定胜负\");\r\n        var tag = this.lastChess.getComponent('chess').tag\r\n        var x =  tag % 15;\r\n        var y = (tag-x) / 15;\r\n        var lastSpriteFrame = this.lastChess.getComponent(cc.Sprite).spriteFrame;\r\n        //横向\r\n        var horizental = 0;\r\n        var isLinked = true;//是否是连子\r\n        for(var i = x-4;i<=x+4;i++){//前四后四一共9颗子\r\n            if(i>=0 && i<15){\r\n                var frame = this.chessList[i*15+y].getComponent(cc.Sprite).spriteFrame;\r\n                if(lastSpriteFrame == frame && isLinked){\r\n                    horizental++;//连子数量\r\n                    isLinked = true;\r\n                }else{\r\n                    //horizental = 0;//重置连子数量\r\n                    if(horizental>0){\r\n                        isLinked = false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        console.log(this.gameState + '横向连子数量:'+horizental);\r\n        if(horizental>=5){\r\n            console.log(this.gameState+\" win !\");\r\n            return;\r\n        }        \r\n        //纵向\r\n        var vertical = 0;\r\n        isLinked = true;\r\n        for(var i=y-4;i<=y+4;i++){\r\n            if(i>=0 && i<15){\r\n                var frame = this.chessList[y*15+i].getComponent(cc.Sprite).spriteFrame;\r\n                if(lastSpriteFrame == frame && isLinked){\r\n                    vertical++;//连子数量\r\n                    isLinked = true;\r\n                }else{\r\n                    //horizental = 0;//重置连子数量\r\n                    if(vertical>0){\r\n                        isLinked = false;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        console.log(this.gameState+\"纵向连子数量:\"+vertical);\r\n        if(vertical >=5){\r\n            console.log(this.gameState +\" win !\");\r\n            return;\r\n        }\r\n        //左斜（第一与第三象限）\r\n        var leftSlash = 0\r\n        var f = y-x;//斜率K = (y2-y1)/(x2-x1); 此k=1，y2=x2+y1-x1; 设f = y1-x1,那么y2 = x2+f，z = y2*15+x2;遍历x2,z = (f+x2)*15+x2\r\n        for(var i=0;i<15;i++){\r\n            if(f+i<0 || f+i>14){\r\n                continue;\r\n            }\r\n            var frame = this.chessList[(f+i)*15+i].getComponent(cc.Sprite).spriteFrame;\r\n            if(frame == lastSpriteFrame){\r\n                leftSlash++;\r\n            }else{\r\n                leftSlash=0;\r\n            }\r\n        }\r\n        console.log(this.gameState+\"左斜连子数量:\"+leftSlash);\r\n        if(leftSlash>=5){\r\n            console.log(this.gameState+\" win !\");\r\n            return;\r\n        }\r\n        //右斜\r\n        var rightSlash = 0;\r\n        f = y+x;\r\n        for(var i =0;i<15;i++){\r\n            if(f-i < 0 || f-i > 14){ continue; } \r\n            var frame = this.chessList[(f-i)*15+i].getComponent(cc.Sprite).spriteFrame;\r\n            if(frame == lastSpriteFrame){\r\n                rightSlash ++;\r\n            }else{\r\n                rightSlash=0;\r\n            }\r\n        }\r\n        console.log(this.gameState+\"右斜连子数量:\"+rightSlash);\r\n        if(rightSlash>=5){\r\n            console.log(this.gameState+\" win !\");\r\n            return;\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.initiateChessBoard();\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    // update (dt) {},\r\n});\r\n"]}